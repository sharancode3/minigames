<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crazy Type</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,system-ui;background:#070014;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;overflow:hidden}
    h1{font-size:1.9rem;margin:0 0 12px;background:linear-gradient(90deg,#ff004d,#ff7a18,#00f0ff);-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:800;letter-spacing:.5px}
    .board{width:960px;max-width:96vw;height:520px;background:linear-gradient(135deg,#0d001e 0%,#150035 60%,#280048);border:1px solid rgba(255,255,255,.08);border-radius:32px;box-shadow:0 30px 90px rgba(0,0,0,.75);padding:18px 26px;display:flex;flex-direction:column;position:relative}
    .stats{display:flex;flex-wrap:wrap;gap:10px;font-size:.75rem;margin-bottom:6px}
    .stat{background:rgba(255,255,255,.05);padding:6px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);display:flex;flex-direction:column;min-width:100px}
    .stat b{font-size:.7rem;font-weight:600;opacity:.7}
    .stat span{font-size:.9rem;font-weight:700}
    .field{flex:1;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,.05);border-radius:20px;background:radial-gradient(circle at 30% 30%,#160037,#09001a 70%)}
    .word{position:absolute;font-weight:600;font-size:1.05rem;letter-spacing:.5px;white-space:nowrap;display:inline-flex;gap:0}
    .word .done{color:#53ff94;text-shadow:0 0 6px #53ff94;font-weight:700}
    .word .left{color:#fff}
    .word.miss{animation:flash .4s}
    @keyframes flash{0%,100%{filter:brightness(1)}50%{filter:brightness(3)}}
    #overlay{position:fixed;inset:0;background:rgba(12,0,35,.82);backdrop-filter:blur(8px);display:none;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:40px;gap:18px;font-weight:800}
    #overlay.show{display:flex}
    .btn-row{display:flex;gap:14px;flex-wrap:wrap;justify-content:center}
    button{padding:12px 22px;border-radius:18px;border:0;font-weight:700;cursor:pointer;background:linear-gradient(135deg,#ff004d,#ff7a18);color:#070014;font-size:1rem;letter-spacing:.5px}
    button.secondary{background:#12002c;color:#fff;border:1px solid rgba(255,255,255,.2)}
    .pulse{animation:pulse 1.2s infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
    .lvl-up{position:absolute;top:12px;right:18px;background:linear-gradient(135deg,#00f0ff,#ff7a18);color:#090013;padding:8px 16px;border-radius:16px;font-size:.8rem;font-weight:800;letter-spacing:.5px;animation:rise .9s ease forwards}
    @keyframes rise{0%{opacity:0;transform:translateY(-14px)}100%{opacity:1;transform:translateY(0)}}
  </style>
</head>
<body>
  <h1>ðŸ”¥ Crazy Type</h1>
  <div class="board">
    <div class="stats">
      <div class="stat"><b>SCORE</b><span id="score">0</span></div>
      <div class="stat"><b>COMBO</b><span id="combo">x0</span></div>
      <div class="stat"><b>ACCURACY</b><span id="accuracy">100%</span></div>
      <div class="stat"><b>WPM</b><span id="wpm">0</span></div>
      <div class="stat"><b>LEVEL</b><span id="level">1</span></div>
      <div class="stat"><b>TIME LEFT</b><span id="time">90s</span></div>
      <div class="stat"><b>LIVES</b><span id="lives">3</span></div>
      <div class="stat"><b>WORDS</b><span id="words">0</span></div>
    </div>
    <div id="field" class="field" aria-label="playfield"></div>
  </div>
  <div id="overlay" role="dialog" aria-modal="true"></div>
  <script>
    /* Core State */
    const field=document.getElementById('field');
    const overlay=document.getElementById('overlay');
    const scoreEl=id('score'),comboEl=id('combo'),accEl=id('accuracy'),wpmEl=id('wpm'),levelEl=id('level'),timeEl=id('time'),livesEl=id('lives'),wordsEl=id('words');
    function id(x){return document.getElementById(x);}    
    let words=[]; // active word objects
    let running=false,paused=false;
    let score=0,combo=0,typedChars=0,correctChars=0,misses=0,level=1,lives=3,wordsCompleted=0;
    let startTime=0, totalTime=90; // seconds
    let lastSpawn=0, spawnInterval=1400; // ms
    let lastFrame=0; let rafId=null;
    const AudioCtx=window.AudioContext||window.webkitAudioContext;const audioCtx=new AudioCtx();
    function fx(freq=440,type='sine',dur=.12,vol=.18){const o=audioCtx.createOscillator();const g=audioCtx.createGain();o.type=type;o.frequency.value=freq;o.connect(g);g.connect(audioCtx.destination);g.gain.value=vol;o.start();o.stop(audioCtx.currentTime+dur);}    
    function chord(list,baseDur=.18){list.forEach((f,i)=>setTimeout(()=>fx(f,'square',baseDur,.15),i*55));}
    /* Word Source */
    const bank=[
      'code','focus','precision','dynamic','keyboard','velocity','matrix','render','canvas','portal','energy','rhythm','stream','future','endless','galaxy','vector','finish','timed','challenge','momentum','refactor','define','async','typing','buffer','syntax','gradient','impact','mastery','pattern','feature','compute','logical','process','element','physics','quantum','glide','station','neon','chrono','tracker','engine','module','packet','signal','cipher','fusion','ultra','alpha','beta','gamma','delta','vertex','lambda','memory','routing','cluster','design','iterate','network','storage','virtual','kernel','runtime','connect','evolve','optimize','elevate','eclipse','horizon','stellar','orbit','vector','atomic','compile','deploy','encrypt','flow','ghost','hyper','ignite','legend','meteor','nova','pixel','quant','react','stack','unify','vortex','warp','zenith','zen'];
    function pickWord(){const lenBias=Math.min(level,15);let candidates=bank.filter(w=>w.length<=4+lenBias);if(candidates.length<5)candidates=bank;return candidates[Math.floor(Math.random()*candidates.length)];}
    function spawn(){const text=pickWord();const speed=2+Math.random()*1.2 + level*0.25;const y=Math.random()*(field.clientHeight-50)+10;const el=document.createElement('div');el.className='word';el.style.top=y+'px';el.style.left=field.clientWidth-10+'px';const done=document.createElement('span');done.className='done';const left=document.createElement('span');left.className='left';left.textContent=text;el.appendChild(done);el.appendChild(left);field.appendChild(el);words.push({text,progress:0,x:field.clientWidth-10,y,speed,el,done,left});}
    function startGame(){resetState();running=true;paused=false;overlay.classList.remove('show');startTime=performance.now();lastSpawn=performance.now();lastFrame=performance.now();fx(600,'triangle',.18,.25);loop();}
    function resetState(){words.forEach(w=>w.el.remove());words=[];score=0;combo=0;typedChars=0;correctChars=0;misses=0;level=1;lives=3;wordsCompleted=0;totalTime=90;updateHUD();}
    function gameOver(){running=false;cancelAnimationFrame(rafId);chord([780,660,540]);const acc=typedChars?Math.round((correctChars/typedChars)*100):100;const wpm=calcWPM();overlay.innerHTML=`<div style='font-size:2.2rem'>GAME OVER</div><div style='font-size:1rem;font-weight:600'>Score ${score} â€¢ WPM ${wpm} â€¢ Acc ${acc}% â€¢ Level ${level}</div><div class='btn-row'><button id='playBtn'>Play Again</button></div>`;overlay.classList.add('show');id('playBtn').addEventListener('click',startGame);try{window.parent.postMessage({type:'game_over',gameId:'crazytype',result:'completed',score,stats:{accuracy:acc,wpm,level}},'*');}catch(e){}
    }
    function levelUp(){level++;spawnInterval=Math.max(450,1400 - level*60);const tag=document.createElement('div');tag.className='lvl-up';tag.textContent='LEVEL '+level;field.appendChild(tag);setTimeout(()=>tag.remove(),1600);chord([520,640,760]);}
    function updateHUD(){comboEl.textContent='x'+combo;scoreEl.textContent=score;accEl.textContent=(typedChars?Math.round((correctChars/typedChars)*100):100)+'%';wpmEl.textContent=calcWPM();levelEl.textContent=level;wordsEl.textContent=wordsCompleted;livesEl.textContent=lives;timeEl.textContent=Math.max(0,Math.ceil(totalTime-(performance.now()-startTime)/1000))+'s';}
    function calcWPM(){const elapsed=(performance.now()-startTime)/1000;if(!running||elapsed<=0)return 0;return Math.round(((correctChars/5)/elapsed)*60);}    
    function loop(){if(!running){return;}rafId=requestAnimationFrame(loop);const now=performance.now();const dt=now-lastFrame;lastFrame=now; // spawn
      if(!paused && now-lastSpawn>spawnInterval){spawn();lastSpawn=now;}
      if(paused){return;}
      // move words
      for(let i=words.length-1;i>=0;i--){const w=words[i];w.x-=w.speed;w.el.style.left=w.x+'px';if(w.x + w.el.clientWidth < 0){ // missed
          words.splice(i,1);w.el.classList.add('miss');setTimeout(()=>w.el.remove(),400);misses++;combo=0;lives--;fx(160,'sawtooth',.22,.25);if(lives<=0){gameOver();return;} }
      }
      // time / end
      const remaining=totalTime-(now-startTime)/1000; if(remaining<=0){gameOver();return;} updateHUD();}
    /* Typing Logic */
    document.addEventListener('keydown',e=>{if(!running){if(e.key===' '){startGame();}return;} if(e.key==='Escape'){togglePause();return;} if(e.key==='p'||e.key==='P'){togglePause();return;} if(paused)return; if(e.key.length===1 && /[a-zA-Z]/.test(e.key)){typedChars++; const ch=e.key.toLowerCase(); // find first word whose next char matches
        let targetWord=null; for(const w of words){const next=w.text[w.progress]; if(next && next.toLowerCase()===ch){targetWord=w;break;}} if(!targetWord){combo=0;score=Math.max(0,score-5);fx(180,'sawtooth',.16,.25); updateHUD(); return;} // advance
        targetWord.progress++; correctChars++; combo++; const base=10+targetWord.progress*2 + level*3; const mult=1+Math.min(combo/25,2.5); score+=Math.round(base*mult); // update spans
        targetWord.done.textContent=targetWord.text.slice(0,targetWord.progress); targetWord.left.textContent=targetWord.text.slice(targetWord.progress); fx(480+Math.min(combo*4,260),'square',.07,.22);
        if(targetWord.progress>=targetWord.text.length){ // complete
          wordsCompleted++; combo+=2; score+=50+level*15; targetWord.el.style.transition='opacity .25s, transform .25s'; targetWord.el.style.opacity='0'; targetWord.el.style.transform='scale(.6) translateY(-10px)'; setTimeout(()=>{targetWord.el.remove(); words=words.filter(x=>x!==targetWord);},260); if(wordsCompleted % 12===0){levelUp();}
        }
        updateHUD();
    }});
    function togglePause(){if(!running)return;paused=!paused;if(paused){overlay.innerHTML=`<div style='font-size:2.2rem'>PAUSED</div><div style='font-size:1rem;font-weight:600'>Press P or ESC to resume</div>`;overlay.classList.add('show');fx(300,'triangle',.15,.2);} else {overlay.classList.remove('show');fx(660,'sine',.12,.22);} }
    /* Initial Overlay */
    function intro(){overlay.innerHTML=`<div style='font-size:2.6rem'>CRAZY TYPE</div><div style='font-size:1rem;font-weight:600;max-width:560px;line-height:1.5'>Type the moving words before they escape. Build COMBO for massive points. Missed words cost lives. Level up every 12 words. 90 second sprint. SPACE to start â€¢ P to pause â€¢ ESC also pauses.</div><div class='btn-row'><button id='startBtn' class='pulse'>Start (SPACE)</button><button id='practiceBtn' class='secondary'>Slow Warmup</button></div>`;overlay.classList.add('show');id('startBtn').addEventListener('click',startGame);id('practiceBtn').addEventListener('click',()=>{totalTime=120;spawnInterval=1700;startGame();});}
    intro();
  </script>
</body>
</html>